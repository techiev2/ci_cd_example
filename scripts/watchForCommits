#!/usr/bin/env bash
source "$(dirname ${BASH_SOURCE[0]})/utils"
currFile=$(realpath ${BASH_SOURCE})
logInfo "Watching for local commits."
fswatch -o .git/logs/refs/heads/* ${currFile} | while read; do
    CURRENT_BRANCH=$(git branch --show-current)
    if [ -n "$CURRENT_BRANCH" ]; then
        AHEAD=$(git rev-list --count "origin/$CURRENT_BRANCH..HEAD" 2>/dev/null)
        if [ "$AHEAD" -gt 0 ]; then
            logInfo "Pushing $AHEAD commit(s) to origin/$CURRENT_BRANCH"
            git push origin "$CURRENT_BRANCH"
        fi
    fi
done
